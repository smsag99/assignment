<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <script>
        function getFromStorage(){
            return stringToJSon(localStorage.getItem("arrayTasks"));
        }
        function setToStorage(){
            localStorage.setItem("arrayTasks",jsonToString(tasks));
        }
        function jsonToString(obj){
            return JSON.stringify(obj);
        }
        function stringToJSon(str){
            return JSON.parse(str);
        }
        function addTask(obj){  
            getFromStorage();
            obj.id = tasks.length;
            tasks.push(obj);
            setToStorage();
            console.log("add is done");
        }
        function deleteTaskByID(id){
            getFromStorage();
            tasks[id] = {};
            setToStorage();
            console.log("delete is done");
        }
        function readTaskByID(id){
            getFromStorage();
            let obj =  tasks[id];
            console.log("read is done");
            return obj;
        }
        function updateTask(obj){
            getFromStorage();
            tasks[obj.id] =obj;
            setToStorage();
            console.log("update task is done");
        }
        function doingdone(parentObj,subObj = null){
            // getFromStorage();    ////update has get
            if(subObj ===null){
                parentObj.isDone = true;
                updateTask(parentObj);
            }else {
                subObj.isDone = true;
                updateSub(parentObj,subObj);
            }
            setToStorage();
            console.log("doing Done is done");
        }
        function filterTasksByStatus(status){
            getFromStorage();
            return tasks.filter(x=>x.isDone == status);
        }
        function searchByTittle(word){
            getFromStorage();
            return tasks.filter(x=>x.title==word);
        }
        function addSub(parentObj,subObj){
            // getFromStorage();      /////readtask has get
            let obj = readTaskByID(parentObj.id);
            subObj.parent = obj.id;
            subObj.id = obj.sub.length;
            obj.sub.push(subObj);
            setToStorage();
        }
        function updateSub(parentObj,subObj){
            // getFromStorage();     ////read has get
            let obj = readTaskByID(parentObj.id);
            obj.sub[subObj.id] = subObj;
            setToStorage();
            console.log("update task is done");       
        }
        function deleteSub(parentObj,subObj){
            // getFromStorage();     ////read has get
            let obj = readTaskByID(parentObj.id);
            obj.sub[subObj.id] = {};
            setToStorage();
            console.log("update task is done");
        }
        function allDone(parentObj){
            let obj = readTaskByID(parentobj.id);
            let resault = obj.sub.every(x=>x.isDone==true);
            doingdone(obj);
        }





        
        //////run////
        localStorage.clear();
        let tasks = [];
        if(localStorage.arrayTasks == undefined || localStorage.arrayTasks ==null){
            localStorage.setItem("arrayTasks",jsonToString(tasks));
            console.log("initial array of tasks is done");
        }
        task1 = {
            id: 0,
            title: 'test1' ,
            describtion: "",
            isDone: false,
            time: new Date(),
            sub: []
        };
        task2 = {
            id: 0,
            title: `test2` ,
            describtion: "",
            isDone: false,
            time: new Date(),
            sub: []
        };
        task3 = {
            id: 0,
            title: `test3` ,
            describtion: "",
            isDone: false,
            time: new Date(),
            sub:[]
        };
        task4 = {
            id: 0,
            title: `test4` ,
            describtion: "",
            isDone: false,
            time: new Date(),
            sub:[]
        };
        subTask1 = {
            id: 0,
            title: `test4` ,
            describtion: "",
            isDone: false,
            time: new Date(),
        };
        addTask(task1);
        addTask(task2);
        addTask(task3);
        addTask(task4);
        updateTask({
            id: 2,
            title: `test6` ,
            describtion: "",
            isDone: false,
            time: new Date(),
            parent:0
        });
        doingdone(2);
        addSub(readTaskByID(3),subTask1)
        console.log(readTaskByID(3));
        console.log(sub in subTask1)
        

        // console.log(tasks);
        //console.log(readTaskByID(2));
        

        






    </script>
</body>
</html>